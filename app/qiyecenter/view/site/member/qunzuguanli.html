<script>
    window.loadedPart = [1,0,(new Date).getTime()];
    BREADCRUMBS ='0:0';
    MODALPANEL = {
        createModalPanel:function(){
            var mp = new Element('div',{'id':'MODALPANEL'});
            var mpStyles = {
                'position': 'fixed',
                'background': '#333333',
                'width': '100%',
                'display':'none',
                'height': window.getScrollSize().y,
                'top': 0,
                'left': 0,
                'zIndex': 65500,
                'opacity': .4
            };
            this.element = mp.setStyles(mpStyles).inject(document.body);
            return this.element;
        },
        show:function(){
            var panel = this.element = this.element||this.createModalPanel();
            panel.setStyles({
                'width': '100%',
                'height': window.getScrollSize().y
            }).show();
        },hide:function(){
            if(this.element)this.element.hide();
        }
    };
    Xtip = new Tips({tip:'tip_Xtip',fixed:true,offset: {x: 24, y: -15},onBound:function(bound){
        if(bound.x2){
            this.tip.getElement('.tip-top').addClass('tip-top-right');
            this.tip.getElement('.tip-bottom').addClass('tip-bottom-right');
        }else {
            this.tip.getElement('.tip-top').removeClass('tip-top-right');
            this.tip.getElement('.tip-bottom').removeClass('tip-bottom-right');
        }
    }});
    var LAYOUT = {
        container: $('container'),
        side: $('side'),
        workground: $('workground'),
        content_main: $('main'),
        content_head: $E('#workground .content-head'),
        content_foot: $E('#workground .content-foot'),
        side_r: $('side-r'),
        side_r_content:$('side-r-content')
    };
</script>
<{script src="load.js" app="qiyecenter" pdir="js"}>
<{script src="wpage.js" app="qiyecenter" pdir="js"}>
<script>
    var W = new Wpage({});
</script>
<{script src="dialog.js" app="qiyecenter" pdir="js"}>
<{script src="modedialog.js" app="qiyecenter" pdir="js"}>
<div class="qiye_list">
    <div class="right_top">
        <div class="r_tit">
            <div class="guanlibumen">群组管理</div>
        </div>
        <{if $SETUP_MANAGER_TYPE == 'I03701'}>
        <div class="create_de">
            <div class="an_input" onclick="add_department()">创建群组</div>
        </div>
        <{else}>
        <div class="create_de" style="display: none;">
            <div class="an_input" onclick="add_department()">创建群组</div>
        </div>
        <{/if}>

    </div>
    <form method="post" action="<{link app=qiyecenter ctl=site_member act=qunzuguanli}>">
        <div class="right_selectbycon">
            <div class="r_center">
                <div class="suoshuqiye">商社名称</div>
                <div class="suoshuqiye">
                    <input type="text" style="border: 1px solid #ccc;width: 100px;" name="CUSTOMER_NAME"/>
                </div>
                <div class="suoshuqiye">
                    <input type="submit" value="搜索" class="search_bott" />
                </div>
            </div>
        </div>
    </form>
    <{if $sfscdata}>
    <div class="r_list">
        <div class="show_list">
            <div class="list_head">
                <div class="head_font" style="width: 20%;">商社名称</div>
                <div class="head_font">群组名称</div>
                <div class="head_font" style="width: 10%;">福点余额</div>
                <div class="head_font" style="width: 40%;">操作</div>
            </div>
            <{foreach from=$sfscdata item=item}>
            <div class="list_con">
                <input type="hidden" name="GROUP_ID" value="<{$item.GROUP_ID}>">
                <input type="hidden" name="COMPANY_NO" value="<{$item.COMPANY_NO}>">
                <div class="head_font" style="width: 20%;"><{$item.CUSTOMER_NAME}></div>
                <div class="head_font"><{$item.GROUP_NAME}></div>
                <div class="head_font" style="width: 10%;"><{$item.BALANCE}></div>
                <div class="head_font" style="width: 40%;">
                    <{if $SETUP_MANAGER_TYPE == 'I03701'}>
                    <font class="edit"><a href="javascript:void(0);">编辑</a></font>
                    <font class="del"><a href="javascript:void(0);">删除</a></font>
                    <font class="employee_edit"><a href="javascript:void(0);" onclick="employeemanagement(this)">员工管理</a></font>
                    <font class="setmanger"><a href="javascript:void(0);">设置管理员</a></font>
                    <font class="selectmanger"><a href="javascript:void(0);">查看管理员</a></font>
                    <{/if}>



                </div>
            </div>
            <{/foreach}>
        </div>
    </div>
    <input type='hidden' id='current_page' value='0' />
    <div class="show_fenye">
        <div class="feny" id="page_navigation">
        </div>
    </div>
    <{else}>
    <div style="border:1px solid #eee;height:40px;line-height:40px;text-align:center">没有找到相应的群组</div>
    <{/if}>
</div>
<script type="text/javascript">
    var per_page = 10;
    var items = document.getElementsByClassName("list_con");
    var pages = Math.ceil(items.length/per_page);
    gotopage(0);

    function gotopage(page){
        for(var i=0;i<items.length;i++){
            items[i].style.display='none';
        }
        for(var i=page*per_page;i<(page+1)*per_page;i++){
            if(i<items.length){
                items[i].style.display='block';
            }
        }
        var navigation_html = '<a class="page_link" title="上一页" href="javascript:prepage();">&lt;</a>';

        for(var current_link = 0; current_link < pages; current_link++){
            if(pages<=10){
                current_link == page?navigation_html += '<a class="page_link on" href="javascript:gotopage(' + current_link +')" >'+ (current_link + 1) +'</a>':navigation_html += '<a class="page_link" href="javascript:gotopage(' + current_link +')" >'+ (current_link + 1) +'</a>';
            }else{
                if(current_link == page){
                    navigation_html += '<a class="page_link on" href="javascript:gotopage(' + current_link +')" >'+ (current_link + 1) +'</a>';
                }
                if(current_link <= (page+4)&&current_link >= (page-4)&&current_link != page){
                    navigation_html += '<a class="page_link" href="javascript:gotopage(' + current_link +')" >'+ (current_link + 1) +'</a>';
                }
            }
        }
        navigation_html += '<a class="page_link" title="下一页" href="javascript:nextpage();">&gt;</a>';
        document.getElementById("page_navigation").innerHTML= navigation_html;
        document.getElementById("current_page").value= page;

    }
    function nextpage(){
        var page = parseInt(document.getElementById("current_page").value);
        if(page < pages - 1){
            gotopage((page+1));
            document.getElementById("current_page").value= page+1;
        }
    }
    function prepage(){
        var page = parseInt(document.getElementById("current_page").value);
        if(page > 0){
            gotopage((page - 1));
            document.getElementById("current_page").value= page - 1;
        }
    }


</script>
<script type="text/javascript">
    function add_department(){
        var url = "<{link app=qiyecenter ctl=site_member act=add_qunzu1}>";
        new Ex_Dialog(url, {
            title: '创建群组',
            width: 600,
            height: 280,
            modal: true,
            onLoad:function(){},
            asyncOptions: {}
        });
    }

    function employeemanagement(el){
        var GROUP_ID = el.getParent(".list_con").getChildren("input[name='GROUP_ID']").getValue();
        var COMPANY_NO= el.getParent(".list_con").getChildren("input[name='COMPANY_NO']").getValue();
        Ex_Loader('modedialog',function(){
            new ModeDialog('<{link app=qiyecenter ctl=site_member act=employeemanagement_qunzu}>?GROUP_ID='+GROUP_ID+'&COMPANY_NO='+COMPANY_NO,{
                width:600,height:600,params:{iptText:1,iptHidden:2}});
        });
    }


    window.addEvent('domready',function(){
        $$('.list_con').getElements(".edit").each(function(item){
            item.addEvent('click',function(){
                var GROUP_ID = this.getParent(".list_con").getChildren("input[name='GROUP_ID']").getValue();
                var COMPANY_NO= this.getParent(".list_con").getChildren("input[name='COMPANY_NO']").getValue();
                var url = "<{link app=qiyecenter ctl=site_member act=add_qunzu}>";
                new Ex_Dialog(url, {
                    title: '编辑群组',
                    width: 600,
                    height: 280,
                    modal: true,
                    onLoad:function(){
                    },
                    asyncOptions: {
                        data:'qunzu_edit=true&GROUP_ID='+GROUP_ID+'&COMPANY_NO='+COMPANY_NO
                    }
                });
            });
        });
        //删除员工
        $$('.list_con').getElements(".del").each(function(item){
            item.addEvent('click',function() {
                var GROUP_ID = this.getParent(".list_con").getChildren("input[name='GROUP_ID']").getValue();
                var COMPANY_NO= this.getParent(".list_con").getChildren("input[name='COMPANY_NO']").getValue();
                var src = '<{link app=qiyecenter ctl=site_member act=del_qunzu}>';
                Ex_Dialog.confirm('<{t}>确认删除此群组？<{/t}>', function (e) {
                    if (!e) return;
                    new Request({
                        url: src,
                        data: 'GROUP_ID='+GROUP_ID+'&COMPANY_NO='+COMPANY_NO,
                        onComplete: function (re) {
                            if(re ==null)return;
                            var _success_res = JSON.decode(re);

                            if(_success_res.status =='success') {
                                Message.success(_success_res.message, function(){
                                    location.reload();
                                });

                            } else {
                                Message.error(_success_res.message, function(){
                                    location.reload();
                                });

                            }
                        }
                    }).post();
                });
            });
        });



        $$('.list_con').getElements(".setmanger").each(function(item){
            item.addEvent('click',function() {
                var GROUP_ID = this.getParent(".list_con").getChildren("input[name='GROUP_ID']").getValue();
                var COMPANY_NO= this.getParent(".list_con").getChildren("input[name='COMPANY_NO']").getValue();
                Ex_Loader('modedialog',function(){
                    new ModeDialog('<{link app=qiyecenter ctl=site_member act=department_setmanger_qunzu}>?GROUP_ID='+GROUP_ID+'&COMPANY_NO='+COMPANY_NO,{
                        width:600,height:600,params:{iptText:1,iptHidden:2}});
                });

            });

        });
        //查看管理员
        $$('.list_con').getElements(".selectmanger").each(function(item){
            item.addEvent('click',function() {
                var GROUP_ID = this.getParent(".list_con").getChildren("input[name='GROUP_ID']").getValue();
                var COMPANY_NO= this.getParent(".list_con").getChildren("input[name='COMPANY_NO']").getValue();
                Ex_Loader('modedialog',function(){
                    new ModeDialog('<{link app=qiyecenter ctl=site_member act=department_selectmanger_qunzu}>?GROUP_ID='+GROUP_ID+'&COMPANY_NO='+COMPANY_NO,{
                        width:600,height:600,params:{iptText:1,iptHidden:2}});
                });

            });

        });




    });

</script>