<{css src="shop.css" app='b2c'}>
<{$searchInfo}>
<{if $tabs}>
<ul class="GoodsSearchTabs">
  <li<{if $args.3 eq ''}> class="current"<{/if}>><a href="<{link args=$args arg3=''}>"><span><{t}>全部商品<{/t}></span></a>
  </li>
  <{section name=tabs loop=$tabs}> <li<{if is_numeric($args.3) && $args.3 eq $smarty.section.tabs.index}> class="current"<{/if}>><a href="<{link args=$args arg3=$smarty.section.tabs.index}>"><span><{$tabs[tabs].label}></span></a>
  </li>
  <{/section}>
    <li></li>
</ul>
<{/if}>
<div class="clear"></div>
<div class="GoodsSearchWrap">
	 <form action="<{link ctl=site_search act=result_jdgoods app=b2c}>" id='selector-form'>
      <input type="hidden" name="filter" value="<{$args[1]}>" />
        <{if $cat_id}>
        <input type="hidden" name="cat_id" value="<{$cat_id}>">
        <{/if}>
		<{include file="site/gallery/selector/tmall.html"}>
    </form>
    <script type='text/javascript'>
        var fixEmpeyPanel = (function(el){
                el.setStyle('display',el.get('text').clean().trim()?'block':'none');
                return arguments.callee;
                })($('selector-form'));
        if($('selector-form').style.display!='none'){
            $$('#selector-form .division').each(fixEmpeyPanel);
        }
    </script>
	

    <fieldset class="gallery-bar-box">
        <legend>商品排序</legend>
        <div class="gallerybar clearfix filter" id='gallerybar' >
        
        <form action="<{link ctl=site_search act=result_jdgoods app=b2c}>"  method ="POST" id="J_FForm">
        <div id="J_fRange" class="fRange" style="display: none;">
        </div>
        <a action="orderby" style="padding-left:10px; margin-left: 15px;" href="<{link app=jdsale ctl=site_gallery act=index args=$args2 arg2=1 arg4=1}>?scontent=<{$args1}>" avalue="1" class="fSort <{if $args.2 == 1 || $args.2 == ''}>fSort-cur<{/if}>">
            默认
        </a>
        <a action="orderby" avalue="<{if $args.2 != 2}>2<{else}>1<{/if}>"  title="<{if $args.2 == 2}>点击后恢复默认排序<{else}>点击后按月销量从高到低<{/if}>" <{if $args.2 != 2}>href="<{link app=jdsale ctl=site_gallery act=index args=$args arg2=2 arg4=1}>"<{else}> href="<{link app=jdsale ctl=site_gallery act=index args=$args2 arg2=1  arg4=1}>?scontent=<{$args1}>"<{/if}> class="fSort <{if $args.2 == 2}>fSort-cur<{/if}>">
            销量
            <i class="f-ico-arrow-d"></i>
        </a>
		
		
		<a action="orderby" avalue="<{if $args.2 == 6 ||$args.2 == 7}><{if $args.2 == 7}>6<{else}>7<{/if}><{else}>6<{/if}>"  title="<{if $args.2 == 6 ||$args.2 == 7}><{if $args.2 == 7}>点击后按价格从高到低<{else}>点击后按价格从低到高<{/if}><{else}>点击后按价格从高到低<{/if}>"
           href=" <{if $args.2 == 6 ||$args.2 == 7}><{if $args.2 == 7}><{link app=jdsale ctl=site_gallery act=index args=$args arg2=6}><{else}><{link app=jdsale ctl=site_gallery act=index args=$args2 arg2=7 arg4=1}>?scontent=<{$args1}><{/if}><{else}><{link app=jdsale ctl=site_gallery act=index args=$args arg2=6 arg4=1}><{/if}>" class="fSort <{if $args.2 == 6 || $args.2 == 7}>fSort-cur<{/if}>">
            价格
            <i class="f-ico-triangle-mt <{if $args.2 == 7}>f-ico-triangle-mt-slctd<{/if}>"></i>
            <i class="f-ico-triangle-mb <{if $args.2 == 6}>f-ico-triangle-mb-slctd<{/if}>" ></i>
        </a>
		
        <a action="orderby" avalue="<{if $args.2 == 4 ||$args.2 == 5}><{if $args.2 == 5}>4<{else}>5<{/if}><{else}>4<{/if}>"  title="<{if $args.2 == 4 ||$args.2 == 5}><{if $args.2 == 5}>点击后按价格差从高到低<{else}>点击后按价格差从低到高<{/if}><{else}>点击后按价格差从高到低<{/if}>"
           href=" <{if $args.2 == 4 ||$args.2 == 5}><{if $args.2 == 5}><{link app=jdsale ctl=site_gallery act=index args=$args arg2=4}><{else}><{link app=jdsale ctl=site_gallery act=index args=$args2 arg2=5 arg4=1}>?scontent=<{$args1}><{/if}><{else}><{link app=jdsale ctl=site_gallery act=index args=$args arg2=4 arg4=1}><{/if}>" class="fSort <{if $args.2 == 4 || $args.2 == 5}>fSort-cur<{/if}>">
            价格差
            <i class="f-ico-triangle-mt <{if $args.2 == 5}>f-ico-triangle-mt-slctd<{/if}>"></i>
            <i class="f-ico-triangle-mb <{if $args.2 == 4}>f-ico-triangle-mb-slctd<{/if}>" ></i>
        </a>
        
       
           <{if $scon.scontent}>
           <input type=hidden value="<{$scon.scontent}>" name="scontent">
           <{/if}>
           <{if $scon.loc}>
           <input type=hidden value="<{$scon.loc}>" name="loc"> 
           <{/if}>
           <{if $cat_id}>
              <input type="hidden" name="cat_id" value="<{$cat_id}>">
           <{/if}>
           <input type="hidden" name="st" value="<{$args[7]}>" />
           <input type="hidden" name="filter" value="<{$args[1]}>" />
           <input type="hidden" name="cat_type" value="<{$args[5]}>" />
           <input type="hidden" name="orderby"value="<{$args[2]}>" >
           <input type="hidden" name="view" value="<{$curView}>" >
           <input type="hidden" name="page" value="1">
		  
         </form>
            <{jdpagers data=$pager type=mini}> 
        </div>
    </fieldset>
   
    <{if !count($products)}>
    <div class="feed-back m30" >
        <{if $emtpy_info}>
        <div class="lineheight-free"><{$emtpy_info}></div>
        <{else}>
        <h1 class="error" style=""><{t}>非常抱歉，没有找到相关<{if $curView=='index'}>店铺<{else}>商品<{/if}><{/t}></h1>
        <p style="margin:15px 1em;">
        <strong><{t}>建议：<{/t}></strong>
        <br />
        <{t}>适当缩短您的关键词或更改关键词后重新搜索。<{/t}>
        </p>
        <div class="w200 ma">
            <a href="javascript:history.back(1)" class="btn-a">
                <span><{t}>返回上一页<{/t}></span>
            </a>
            <a href="./" class="btn-a pl20 ml10">
                <span><{t}>返回首页<{/t}></span>
            </a>
        </div>
        <{/if}>
    </div>
    <{/if}>
    <{include file=$_PDT_LST_TPL}>
    <{jdpagers data=$pager}>
</div>




<script>
window.addEvent('domready', function(){
  

$('J_fRange').addEvents({
        click:function(){
            window.location.href='<{link app=b2c ctl=site_gallery act=index args=$args2 arg2=1 arg4=1}>?scontent=<{$args1}>';
        }
    });
if($('J_FOriginArea')){
$('J_FOriginArea').addEvents({
     mouseover:function(){
       $(this).getElement('.fA-list').setStyle('display','block');
     },
     mouseleave:function(){
       $(this).getElement('.fA-list').setStyle('display','none');
    },
    click:function(e){
         var el=e.target;
         if(el.get('tag')=='a'){
            e.stop();
            var input=$('J_FOAInput');
            var data_val=el.get('data-val');
            if(data_val){              
               input.value=data_val=='ALL'?'':data_val;
            }else{
              input.value=el.get('html');
            }
            input.getParent('.fAl-custom').submit();
         }
    }
});
}
if($('J_FMenu')){
var j_FMcExpand=$('J_FMenu').getElement('.j_FMcExpand');
if(j_FMcExpand){
j_FMcExpand.addEvent('click',function(e){
    e.stop();
    var div=$(this).getParent('.fMenu');
    div.toggleClass('fMenu-expand');
    $(this).toggleClass('ui-more-expand-l');
    $(this).toggleClass('ui-more-drop-l');
    if(div.hasClass('fMenu-expand')){
        $(this).set('html','收起<i class="ui-more-expand-l-arrow"></i>');
    }else{
        $(this).set('html','更多<i class="ui-more-drop-l-arrow"></i>');
    }
});
}
$('J_FMenu').getElements('input[type=checkbox]').addEvent('click',function(e){
    $('J_FForm').submit();
});
}
var jprice=$('J_FPrice');
if(jprice){
	jprice.getElements('input').each(function(el){
		el.addEvents({
		  focus:function(){
		   jprice.addClass('fPrice-hover');
		  },
		  blur:function(){
		   //jprice.removeClass('fPrice-hover');
		  }
		});
	});
}
//jprice.addEvent('mouseleave',function(){jprice.removeClass('fPrice-hover');});
document.body.addEvent('click',function(e){
  var el=e.target;
  if(el.getParent('.fPrice')){
     return;
  }
  if(jprice){
  jprice.removeClass('fPrice-hover');
  }
});

$('J_FForm').addEvent('click',function(e){
  var el=e.target;
  if(el.get('tag')=='a'){
    e.stop();
    if(el.get('action')){
        $('J_FForm').getElement('input[name="'+el.get('action')+'"]').value=el.get('avalue');
        $('J_FForm').submit();
    }
    if(el.get('id')=='J_FPCancel'){
      jprice.getElements('input').map(function(el,index,arr){ el.value='';arr[0].focus()});
      $('J_FForm').submit();
    }
    if(el.get('id')=='J_FPEnter'){
      $('J_FForm').submit();
    }
    
  }
  
});

    new DataLazyLoad({lazyDataType:'img',img:'lazyload'});
    try{
        /*关键字高亮*/
        (function(replace_str){
            var replace=replace_str.split("+");
            if(replace.length){
                $$('.entry-title, .productShop-name, .shop-header-title').each(function(r){
                    for(i=0;i<replace.length;i++){
                        if(replace[i]){
                            var reg=new RegExp("("+replace[i].escapeRegExp()+")(?!\})","gi");
                            r.set('text',r.get('text').replace(reg,function(){
                                return "{0}"+arguments[1]+"{1}";
                            }));
                        }
                    }
                    r.set('html',r.get('text').substitute({0:"<font color=red>",1:"</font>"}));//原来的增加样式有问题
                });
            }
        })('<{$search_array}>');
    }catch(e){}







    //Gallery bar 滚动定位 -- by Tyler Chao
    var gallerybar = $('gallerybar');
    var gallerybarSize = {
        x:gallerybar.outerSize().x - gallerybar.getPatch().x,
        y:gallerybar.outerSize().y - gallerybar.getPatch().y
    };
    var gallerybarPos  = gallerybar.getPosition();
    var fixedStart = gallerybarPos.y;

    var fixGalleryBar = function(){
        if(fixedStart<this.getScrollTop()){
            if(Browser.ie6) {
                gallerybar.setStyles({'width':gallerybarSize.x - gallerybar.getPatch().x,'position':'absolute','top':this.getScrollTop()})}
            else{
                gallerybar.addClass('fixed').setStyles({'width':gallerybarSize.x - gallerybar.getPatch().x});
            }
            }else{
            if(Browser.ie6) {
                gallerybar.setStyles({'position':'','top':'','width':''});
            };
            gallerybar.removeClass('fixed').setStyle('width','');
        }
    };

    window.addEvents({
        'resize':fixGalleryBar,
        'scroll':fixGalleryBar
    });
});

/*
*商品标签定位
*/
window.addEvent('domready', function() {
    var tips = $$('.goods-tip');
    //var opacity = tips.getElement('img').get('op')[0];
    //tips.getElement('img').setStyle('opacity',opacity);
    if (tips.length > 0) {
        var parSize = {
            x: tips.getParent('.goodpic')[0].getSize().x,
            y: tips.getParent('.goodpic')[0].getSize().y
        };

        var GoodsTipPos = {
            tl: {
                left: 0,
                top: 0
            },
            tc: {
                left: (parSize.x) / 2 - 25,
                top: 0
            },
            tr: {
                top: 0,
                right: 0
            },
            ml: {
                left: 0,
                top: (parSize.y) / 2 - 25
            },
            mc: {
                left: (parSize.x) / 2 - 25,
                top: (parSize.y) / 2 - 25
            },
            mr: {
                top: (parSize.y) / 2 - 25,
                right: 0
            },
            bl: {
                bottom: 0,
                left: 0
            },
            bc: {
                bottom: 0,
                left: (parSize.x) / 2 - 25
            },
            br: {
                bottom: 0,
                right: 0
            }
        };

        tips.each(function(v) {
            v.getElement('img').addEvent('load', function(){
                this.zoomImg(30, 30);
            });
            var ImgSrc = v.getElement('img').get('src');
            if (Browser.ie6) v.getElement('img').setStyle('filter', "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='" + ImgSrc + "')");
            var proPos = v.getElement('img').get('pos');
            var Pos = GoodsTipPos[proPos];
            v.setStyles({
                'top': Pos.top,
                'left': Pos.left,
                'right': Pos.right,
                'bottom': Pos.bottom
            });
        });
    }
});

</script>


