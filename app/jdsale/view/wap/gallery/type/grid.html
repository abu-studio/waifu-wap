<div class='grid clearfix' id="gallery-grid-list">
  <{if count($products) > 0}>
  <ul>
    <{foreach from=$products key=key item=product name=goods}>
    <li style="margin-left: 13px;" class="items-gallery  itemsList" product="<{$product.goods_id}>">
        <!--商品图片-->
        <div class="goodpic" style="width:216px;position:relative; margin:0 auto;height:216px;">
          <a target="_blank" href='<{link app=jdsale ctl=wap_product act=index arg=$product.goods_id}>' style='width:216px; display: table-cell; vertical-align: middle; text-align: center; margin:0 auto;*font-size:192.5px;height:216px;'>
            <{img src="images/transparent.gif" app="b2c" lazyload=$product.image_default_id class="img-lazyload"  alt=$product.name|escape:html}>
          </a>
        </div>
        <div class="goods-main">
        <div class="price-wrap">
           <ul class="price-item" >
           <li style="float:left;">
            <em class="sell-price">
              <{$product.price|cur_odr}>
            </em>
          </li>
          <!--市场价-->
            
          </ul>
          </div>
        <div class="goodinfo" style="padding:5px 0 0;">
            <h3>
            <a style="font-family : 微软雅黑,宋体;font-size :10px" target='_blank' href="<{if $product.goods_url}><{$product.goods_url}><{else}><{link app=jdsale ctl=wap_product act=index arg=$product.goods_id}><{/if}>" title="<{$product.name|escape:html}>" class="entry-title">
           <{$product.name|escape:"html"}>
            </a>
            <{if $product.tags}>
            <{foreach from=$product.tags item=tags}>
            <{if $tags.params.tag_showOnIndex}>
            &nbsp;<span class="tag-label" style="background-color:<{$tags.tag_bgcolor}>;color:<{$tags.tag_fgcolor}>"><{$tags.tag_name}></span>
            <{/if}>
            <{/foreach}>
            <{/if}>
            </h3>
          </div>
        </div>
    </li>
    <{/foreach}>
  </ul>
  <{/if}>
</div>
<script>

var opiton={
    autoRowSize: {'h3': 'height'},
    cols:<{$gallery_display|default:4}>
};
/*可以在全局定义 GALLERY_AutoFloatGrid_Options  覆盖 AutoFloatGrid 的options*/
//opiton=Object.merge(opiton,('GALLERY_AutoFloatGrid_Options' in window) ? GALLERY_AutoFloatGrid_Options: {});
//new AutoFloatGrid('gallery-grid-list', $$('#gallery-grid-list .items-gallery'),opiton );
  /*AUTO HEIGHT*/
  window.addEvent('domready',function(){
    var getAmongPos = function(size,to){
      var elpSize = $(to).getSize(),elpScroll = $(to).getScroll();
      return {
        'top':Math.abs((elpSize.y/2).toInt()-(size.height/2).toInt()+to.getPosition().y+elpScroll.y),
        'left':Math.abs((elpSize.x/2).toInt()-(size.width/2).toInt()+to.getPosition().x+elpScroll.x)
      };
    };
    Ex_Event_Group['_zoomImg_']={fn:function(el,e){
      e.stop();
      if(el.retrieve('active'))return;
      el.store('active',true);
      var tpic = el.getParent('.goods-main').getPrevious('.goodpic').getElement('img');
      var bpic_src = el.get('pic');
      var loading = new Element('div',{
        styles:{'background':'#fff url(<{$env.app.res_url}>/images/loading.gif) no-repeat 50% 50%',
          'width':40,
          'height':40,
          'border':'1px #e9e9e9 solid',
          'opacity':.5}}).inject(document.body).position({target:tpic});
      new Asset.image(bpic_src,{onload:function(img){
          loading.destroy();
          var winsize = window.getSize();
          var imgSize = $(img).zoomImg(winsize.x,winsize.y,1);
            var fxv = Object.append(getAmongPos(imgSize,window),imgSize,{'position':'absolute','z-index':2});
          var imgFx = new Fx.Morph(img,{link:'cancel'});
          img.setStyles(Object.append(tpic.getCoordinates(),{opacity:0.5})).inject(document.body).addClass('img-zoom').addEvent('click',function(){
            imgFx.start(tpic.getCoordinates()).chain(function(){this.element.destroy();el.store('active',false);});
          });
          imgFx.start(Object.append(fxv,{opacity:1}));
          document.addEvent('click',function(){
            img.fireEvent('click');
            document.removeEvent('click',arguments.callee);
          });
          },onerror:function(){
            _this.store('active',false);
            loading.destroy();
      }});
  }}
    /*
    *商品标签定位
    */
    var tips = $$('.goods-tip');

    //var opacity = tips.getElement('img').get('op')[0];
    //tips.getElement('img').setStyle('opacity',opacity);
    if(tips.length>0){
      var parSize = {
        x : tips.getParent('.goodpic')[0].getSize().x,
        y : tips.getParent('.goodpic')[0].getSize().y
      };
      var GoodsTipPos= {
        tl:{left:0,top:0},
        tc:{left:(parSize.x)/2 - 25,top:0},
        tr:{top:0,right:0},
        ml:{left:0,top:(parSize.y)/2 - 25},
        mc:{left:(parSize.x)/2 - 25,top:(parSize.y)/2 -25},
        mr:{top:(parSize.y)/2 - 25,right:0},
        bl:{bottom:0,left:0},
        bc:{bottom:0,left:(parSize.x)/2 - 25},
        br:{bottom:0,right:0}
      };
      /*.setStyles({
        'top':Pos.top,
        'left':Pos.left,
        'right':Pos.right,
        'bottom':Pos.bottom
      });
      */
      tips.each(function(v){
        v.getElement('img').zoomImg(50,50);
        var ImgSrc = v.getElement('img').get('src');
        var ImgStr = "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+ImgSrc+"')";
        if(Browser.ie6)
        v.getElement('img').setStyle('filter',ImgStr);
        var proPos = v.getElement('img').get('pos');
        var Pos = GoodsTipPos[proPos];
        //      if(Browser.ie6) {
          //     if(Pos.left === 0 && Pos.top===0)
          //         Pos.left -= v.getParent().getSize().x/2;
          //    };
        v.setStyles({
          'top':Pos.top,
          'left':Pos.left,
          'right':Pos.right,
          'bottom':Pos.bottom
        });
        //if(Browser.ie6) {
          //      if(Pos.left === 0 && Pos.top===0)
          //    Pos.left += v.getParent().getSize().x/2
          //};
      });
    }
  });
</script>
