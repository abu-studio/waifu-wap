<div class="action-bar">

    <h3><{t}>商品<{/t}></h3>
  <script>
    $$('.order-ctls button[act]').each(function(btn){

      var flow = btn.getPrevious('input[name="flow"]'),
        disabled = btn.getPrevious('input[name="disabled"]'),
        cfm_str = btn.get('confirm'),
        _dialog = null,
        _app	= btn.get('app'),
        act_url = "index.php?app="+_app+"&ctl=admin_order&act={action}&p[0]=<{$order.order_id}>";
      if(disabled){
        return btn.set({'opacity':.5,styles:{'cursor':'not-allowed'}});
      }

      btn.addEvent('click',function(){
        if(cfm_str&&!confirm(cfm_str)){ return;  }
        if(flow){
          _dialog = new Dialog( act_url.substitute({'action':'go'+btn.get('act')}),
            {title:btn.get('text')+":<{$order.order_id}>",width:.7,height:.8,onLoad:function(){

              var _dialog_form = this.dialog;
              this.dialog.getElement('form').store('target',{
                onRequest:function(){
                  _dialog_form.getElement('.table-action .order-action').set('disabled','disabled');
                },
                onComplete:function(){

                  <{if !$env.get.singlepage}>
                  <{if $env.get.finder_id}>
                  finderGroup['<{$env.get.finder_id}>'].request({
                    method:'post',
                    onComplete:function(){
                      _dialog.close();
                      this.loadPacket();//refersh finder packet(tabs);
                    }});
                  <{/if}>
                  <{else}>
                  _dialog.close();
                  if (opener.finderGroup&&opener.finderGroup['<{$env.get.finder_id}>'])
                    opener.finderGroup['<{$env.get.finder_id}>'].refresh();
                  location.reload();
                  <{/if}>
                }});


            }});

        }else{
          W.page( act_url.substitute({'action':'do'+btn.get('act')}),{onComplete:function(re){
            try{re = JSON.decode(re)}catch(e){}
            if(re&&re.error){return;}
            <{if !$env.get.singlepage}>
            <{if $env.get.finder_id}>
            finderGroup['<{$env.get.finder_id}>'].refresh();
            <{/if}>
            <{else}>
            if (opener.finderGroup&&opener.finderGroup['<{$env.get.finder_id}>'])
              opener.finderGroup['<{$env.get.finder_id}>'].refresh();
            location.reload();
            <{/if}>

          }});
        }

      });

    });
  </script>
</div>
<div class="division">
  <div  class="table-grid">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gridlist">
      <col style="width:10%"/>
      <col style="width:25%"/>
      <col style="width:5%"/>
      <col style="width:10%"/>
      <col style="width:10%"/>
      <thead>
        <tr>
        <th><{t}>货号<{/t}></th>
        <th><{t}>商品名称<{/t}></th>
        <th><{t}>销售单价<{/t}></th>
        <th><{t}>合计价格<{/t}></th>
        <th><{t}>数量<{/t}></th>

        </tr>
      </thead>
      <{if count($goodsItems) > 0}>
      <{foreach from=$goodsItems item=aGoods name="item"}>
      <tr>
        <td width="12%"><{$aGoods.goodsId}></td>

        <td class="textleft" width="12%">
          <{$aGoods.goodsName}>
        <a style='text-decoration:none;' class='x-view-img' href='javascript:void(0);' imgsrc='<{$aGoods.goodsImgUrl|default:$env.conf.site.default_thumbnail_pic|storager:'s'}>'  title='<{$aGoods.goodsName}>'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </td>
        <td width="9%"><{$aGoods.goodsPointPrice}></td>
        <td class="Colamount" width="9%"><{$aGoods.total_amount}></td>
        <td class="Colamount"><{$aGoods.goodsNum}></td>
      </tr>
      <{/foreach}>
      <{/if}>

    </table>

  </div>
</div>

<script>
  $$('.x-view-img').each(function(item){
    item.store('tip:text','<div style="width:220px;height:220px;overflow:hidden;"><img  src="'+item.get('imgsrc')+'" onload="$(this).zoomImg(220,220);" /></div>');
    Xtip.attach(item);
  });
</script>